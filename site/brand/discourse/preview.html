<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SUEWS Brand Workshop</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image-more/3.1.6/dom-to-image-more.min.js"></script>
  <style>
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #334155;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border: #475569;
      --preview-light: #f8fafc;
      --preview-dark: #1a1d2e;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: var(--bg-secondary);
      padding: 20px 32px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header h1 img { width: 32px; height: 32px; }

    .header-actions { display: flex; gap: 12px; }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 4px;
      padding: 16px 32px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
    }

    .tab {
      padding: 10px 20px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .tab:hover { background: var(--bg-card); color: var(--text-primary); }
    .tab.active { background: var(--accent); color: white; }

    /* Main Layout */
    .main {
      display: grid;
      grid-template-columns: 380px 1fr;
      height: calc(100vh - 130px);
    }

    /* Sidebar Controls */
    .sidebar {
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      overflow-y: auto;
      padding: 24px;
    }

    .panel {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .panel-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .control-group {
      margin-bottom: 16px;
    }

    .control-group:last-child { margin-bottom: 0; }

    .control-label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .control-label span {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .control-value {
      font-size: 13px;
      font-weight: 600;
      color: var(--accent);
      font-family: 'SF Mono', Monaco, monospace;
    }

    .control-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    input[type="range"] {
      flex: 1;
      height: 6px;
      -webkit-appearance: none;
      background: var(--bg-primary);
      border-radius: 3px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.1s;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
    }

    input[type="number"] {
      width: 70px;
      padding: 8px 10px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 13px;
      font-weight: 500;
      text-align: right;
      font-family: 'SF Mono', Monaco, monospace;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* Hide spinner arrows */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:hover { background: var(--accent-hover); }

    .btn-success { background: var(--success); color: white; }
    .btn-success:hover { background: #16a34a; }

    .btn-secondary {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .btn-sm { padding: 6px 12px; font-size: 12px; }

    .btn-group {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .btn-group .btn { flex: 1; }

    /* Preview Area */
    .preview-area {
      padding: 32px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .preview-container {
      width: 100%;
      max-width: 800px;
    }

    .preview-card {
      background: var(--bg-secondary);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
    }

    .preview-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 16px;
    }

    .preview-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .preview-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .preview-item-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .preview-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      border-radius: 8px;
      background: repeating-conic-gradient(#e5e7eb 0% 25%, white 0% 50%) 50% / 16px 16px;
    }

    /* Banner Styles */
    .banner {
      display: inline-flex;
      align-items: center;
    }

    .banner img { display: block; }

    .banner .text {
      font-family: 'Inter', system-ui, sans-serif;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .light { background: var(--preview-light); }
    .light .text { color: #1a1d2e; }
    .dark { background: var(--preview-dark); }
    .dark .text { color: #ffffff; }

    /* Stacked Icon Styles */
    .stacked-preview-grid {
      display: flex;
      gap: 32px;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .stacked-item {
      text-align: center;
    }

    .stacked-item-size {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    /* Info Panel */
    .info-panel {
      background: var(--bg-primary);
      border-radius: 12px;
      padding: 20px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 12px;
      line-height: 1.7;
      color: var(--text-secondary);
      max-height: 300px;
      overflow-y: auto;
    }

    .info-section {
      margin-bottom: 16px;
    }

    .info-section:last-child { margin-bottom: 0; }

    .info-title {
      color: var(--text-muted);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
    }

    .info-value { color: var(--text-primary); }
    .info-good { color: var(--success); }
    .info-warn { color: var(--warning); }
    .info-bad { color: var(--danger); }

    /* Status Badge */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    .status-good { background: rgba(34, 197, 94, 0.15); color: var(--success); }
    .status-warn { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
    .status-bad { background: rgba(239, 68, 68, 0.15); color: var(--danger); }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--bg-card);
      color: var(--text-primary);
      padding: 14px 20px;
      border-radius: 8px;
      font-size: 14px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { border-left: 4px solid var(--success); }

    /* Tab Content */
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Presets */
    .presets {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .preset-btn {
      padding: 6px 12px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preset-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Quick Stats */
    .quick-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--bg-primary);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }

    .stat-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>
      <img src="../suews-logo.svg" alt="">
      SUEWS Brand Workshop
    </h1>
    <div class="header-actions">
      <button class="btn btn-secondary btn-sm" onclick="exportAll()">Export All Assets</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" onclick="switchTab('banner')">Banner</button>
    <button class="tab" onclick="switchTab('stacked')">Stacked Icon</button>
    <button class="tab" onclick="switchTab('discourse')">Discourse Assets</button>
  </nav>

  <main class="main">
    <!-- Banner Tab -->
    <aside class="sidebar" id="sidebar-banner">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Presets</span>
        </div>
        <div class="presets">
          <button class="preset-btn" onclick="applyBannerPreset('discourse')">Discourse</button>
          <button class="preset-btn" onclick="applyBannerPreset('github')">GitHub</button>
          <button class="preset-btn" onclick="applyBannerPreset('compact')">Compact</button>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Dimensions</span>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Logo Size</span>
            <span class="control-value" id="logoSize-display">56px</span>
          </div>
          <div class="control-row">
            <input type="range" id="logoSize" min="32" max="80" value="56" step="0.1">
            <input type="number" id="logoSizeNum" min="32" max="80" value="56" step="0.1">
          </div>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Text Size</span>
            <span class="control-value" id="textSize-display">42px</span>
          </div>
          <div class="control-row">
            <input type="range" id="textSize" min="24" max="60" value="42" step="0.1">
            <input type="number" id="textSizeNum" min="24" max="60" value="42" step="0.1">
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Spacing</span>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Gap</span>
            <span class="control-value" id="gap-display">0px</span>
          </div>
          <div class="control-row">
            <input type="range" id="gap" min="0" max="20" value="0" step="0.1">
            <input type="number" id="gapNum" min="0" max="20" value="0" step="0.1">
          </div>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Padding Left</span>
            <span class="control-value" id="paddingLeft-display">0px</span>
          </div>
          <div class="control-row">
            <input type="range" id="paddingLeft" min="0" max="20" value="0" step="0.1">
            <input type="number" id="paddingLeftNum" min="0" max="20" value="0" step="0.1">
          </div>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Padding Right</span>
            <span class="control-value" id="paddingRight-display">8px</span>
          </div>
          <div class="control-row">
            <input type="range" id="paddingRight" min="0" max="20" value="8" step="0.1">
            <input type="number" id="paddingRightNum" min="0" max="20" value="8" step="0.1">
          </div>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Padding Vertical</span>
            <span class="control-value" id="paddingY-display">4px</span>
          </div>
          <div class="control-row">
            <input type="range" id="paddingY" min="0" max="20" value="4" step="0.1">
            <input type="number" id="paddingYNum" min="0" max="20" value="4" step="0.1">
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Export</span>
        </div>
        <div class="btn-group" style="margin-top: 0;">
          <button class="btn btn-success btn-sm" onclick="exportBannerPNG('light')">Light PNG</button>
          <button class="btn btn-success btn-sm" onclick="exportBannerPNG('dark')">Dark PNG</button>
        </div>
        <div class="btn-group">
          <button class="btn btn-success btn-sm" onclick="exportBannerPNG('both')">Both PNGs</button>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" onclick="copyBannerCSS()">Copy CSS</button>
        <button class="btn btn-secondary" onclick="resetBanner()">Reset</button>
      </div>
    </aside>

    <!-- Stacked Icon Tab Sidebar -->
    <aside class="sidebar" id="sidebar-stacked" style="display: none;">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Quick Actions</span>
        </div>
        <div class="presets">
          <button class="preset-btn" onclick="suggestStackedOptimal()">Auto-Optimise</button>
          <button class="preset-btn" onclick="applyStackedPreset('512')">512px</button>
          <button class="preset-btn" onclick="applyStackedPreset('256')">256px</button>
          <button class="preset-btn" onclick="applyStackedPreset('128')">128px</button>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Icon Size</span>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Canvas Size</span>
            <span class="control-value" id="iconSize-display">512px</span>
          </div>
          <div class="control-row">
            <input type="range" id="iconSize" min="64" max="512" value="512" step="1">
            <input type="number" id="iconSizeNum" min="64" max="512" value="512" step="0.1">
          </div>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Fill %</span>
            <span class="control-value" id="stackFillPercent-display">100%</span>
          </div>
          <div class="control-row">
            <input type="range" id="stackFillPercent" min="80" max="130" value="100" step="1">
            <input type="number" id="stackFillPercentNum" min="80" max="130" value="100" step="1">
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Logo & Text</span>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Logo Size</span>
            <span class="control-value" id="stackLogoPercent-display">75%</span>
          </div>
          <div class="control-row">
            <input type="range" id="stackLogoPercent" min="50" max="95" value="75" step="0.1">
            <input type="number" id="stackLogoPercentNum" min="50" max="95" value="75" step="0.1">
          </div>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Text Size</span>
            <span class="control-value" id="stackTextSize-display">72px</span>
          </div>
          <div class="control-row">
            <input type="range" id="stackTextSize" min="20" max="120" value="72" step="0.1">
            <input type="number" id="stackTextSizeNum" min="20" max="120" value="72" step="0.1">
          </div>
        </div>

        <div class="control-group">
          <div class="control-label">
            <span>Text Offset</span>
            <span class="control-value" id="stackTextOffset-display">-50px</span>
          </div>
          <div class="control-row">
            <input type="range" id="stackTextOffset" min="-80" max="20" value="-50" step="0.1">
            <input type="number" id="stackTextOffsetNum" min="-80" max="20" value="-50" step="0.1">
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Symmetry Status</span>
        </div>
        <div class="quick-stats">
          <div class="stat-card">
            <div class="stat-value" id="h-diff">0.0</div>
            <div class="stat-label">H-Diff (px)</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="v-diff">45.0</div>
            <div class="stat-label">V-Diff (px)</div>
          </div>
        </div>
        <div style="text-align: center;">
          <span class="status-badge status-good" id="symmetry-status">Horizontal Balanced</span>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Export</span>
        </div>
        <div class="btn-group" style="margin-top: 0;">
          <button class="btn btn-success btn-sm" onclick="exportStackedPNG()">PNG</button>
          <button class="btn btn-success btn-sm" onclick="exportStackedPNG(2)">PNG @2x</button>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" onclick="copyStackedCSS()">Copy CSS</button>
        <button class="btn btn-secondary" onclick="resetStacked()">Reset</button>
      </div>
    </aside>

    <!-- Preview Area - Banner -->
    <section class="preview-area" id="preview-banner">
      <div class="preview-container">
        <div class="preview-card">
          <div class="preview-label">Live Preview</div>
          <div class="preview-grid">
            <div class="preview-item">
              <span class="preview-item-label">Light Theme</span>
              <div class="preview-wrapper">
                <div id="banner-light" class="banner light">
                  <img id="logo-light" src="../suews-logo.svg" alt="SUEWS">
                  <span id="text-light" class="text">SUEWS</span>
                </div>
              </div>
            </div>
            <div class="preview-item">
              <span class="preview-item-label">Dark Theme</span>
              <div class="preview-wrapper">
                <div id="banner-dark" class="banner dark">
                  <img id="logo-dark" src="../suews-logo.svg" alt="SUEWS">
                  <span id="text-dark" class="text">SUEWS</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="preview-card">
          <div class="preview-label">Technical Details</div>
          <div class="info-panel" id="info-banner"></div>
        </div>
      </div>
    </section>

    <!-- Preview Area - Stacked -->
    <section class="preview-area" id="preview-stacked" style="display: none;">
      <div class="preview-container">
        <div class="preview-card">
          <div class="preview-label">Live Preview</div>
          <div class="stacked-preview-grid">
            <div class="stacked-item">
              <div class="preview-wrapper" style="padding: 8px;">
                <div id="stacked-icon" style="display: flex; flex-direction: column; align-items: center; justify-content: flex-start; background: #f8fafc;">
                  <img id="stacked-logo" src="../suews-logo.svg" alt="SUEWS">
                  <span id="stacked-text" style="font-family: 'Inter', system-ui, sans-serif; font-weight: 600; color: #1a1d2e; letter-spacing: -0.02em;">SUEWS</span>
                </div>
              </div>
              <div class="stacked-item-size" id="stacked-size-label">512 x 512</div>
            </div>
            <div class="stacked-item">
              <div class="preview-wrapper" style="padding: 8px;">
                <div id="stacked-icon-small" style="display: flex; flex-direction: column; align-items: center; justify-content: flex-start; background: #f8fafc;">
                  <img id="stacked-logo-small" src="../suews-logo.svg" alt="SUEWS">
                  <span id="stacked-text-small" style="font-family: 'Inter', system-ui, sans-serif; font-weight: 600; color: #1a1d2e; letter-spacing: -0.02em;">SUEWS</span>
                </div>
              </div>
              <div class="stacked-item-size">120 x 120 (scaled)</div>
            </div>
          </div>
        </div>

        <div class="preview-card">
          <div class="preview-label">Margin Analysis</div>
          <div class="info-panel" id="info-stacked"></div>
        </div>
      </div>
    </section>

    <!-- Discourse Assets Tab Sidebar -->
    <aside class="sidebar" id="sidebar-discourse" style="display: none;">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Required Assets</span>
        </div>
        <div class="info-panel" style="background: transparent; padding: 0; max-height: none;">
          <div class="info-section">
            <div class="info-title">Wide Banners (height 120px)</div>
            <div class="info-row"><span>Logo</span><span class="info-value">Light theme</span></div>
            <div class="info-row"><span>Logo Dark</span><span class="info-value">Dark theme</span></div>
            <div class="info-row"><span>Mobile Logo</span><span class="info-value">Same as logo</span></div>
            <div class="info-row"><span>Digest Logo</span><span class="info-value">PNG only</span></div>
          </div>
          <div class="info-section">
            <div class="info-title">Square Icons</div>
            <div class="info-row"><span>Logo Small</span><span class="info-value">120 x 120</span></div>
            <div class="info-row"><span>Logo Small Dark</span><span class="info-value">120 x 120</span></div>
            <div class="info-row"><span>Large Icon</span><span class="info-value">512 x 512</span></div>
            <div class="info-row"><span>Manifest Icon</span><span class="info-value">512 x 512</span></div>
            <div class="info-row"><span>OpenGraph</span><span class="info-value">512 x 512</span></div>
          </div>
          <div class="info-section">
            <div class="info-title">Special Sizes</div>
            <div class="info-row"><span>Favicon</span><span class="info-value">32 x 32 PNG</span></div>
            <div class="info-row"><span>Apple Touch</span><span class="info-value">180 x 180</span></div>
            <div class="info-row"><span>Twitter Card</span><span class="info-value">280 x 150+</span></div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Quick Export</span>
        </div>
        <div class="btn-group" style="margin-top: 0; flex-direction: column;">
          <button class="btn btn-success" onclick="exportDiscourseAll()">Export All Discourse Assets</button>
        </div>
        <div class="btn-group" style="flex-direction: column;">
          <button class="btn btn-primary btn-sm" onclick="exportDiscourseBanners()">Export Banners Only</button>
          <button class="btn btn-primary btn-sm" onclick="exportDiscourseIcons()">Export Icons Only</button>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Individual Assets</span>
        </div>
        <div class="btn-group" style="margin-top: 0; flex-wrap: wrap;">
          <button class="btn btn-secondary btn-sm" onclick="exportSingleDiscourse('logo')">Logo</button>
          <button class="btn btn-secondary btn-sm" onclick="exportSingleDiscourse('logo-dark')">Logo Dark</button>
          <button class="btn btn-secondary btn-sm" onclick="exportSingleDiscourse('logo-small')">Small</button>
          <button class="btn btn-secondary btn-sm" onclick="exportSingleDiscourse('logo-small-dark')">Small Dark</button>
        </div>
        <div class="btn-group" style="flex-wrap: wrap;">
          <button class="btn btn-secondary btn-sm" onclick="exportSingleDiscourse('large-icon')">Large Icon</button>
          <button class="btn btn-secondary btn-sm" onclick="exportSingleDiscourse('favicon')">Favicon</button>
          <button class="btn btn-secondary btn-sm" onclick="exportSingleDiscourse('apple-touch')">Apple Touch</button>
        </div>
      </div>
    </aside>

    <!-- Preview Area - Discourse -->
    <section class="preview-area" id="preview-discourse" style="display: none;">
      <div class="preview-container">
        <div class="preview-card">
          <div class="preview-label">Banner Logos (Wide Format)</div>
          <div class="preview-grid">
            <div class="preview-item">
              <span class="preview-item-label">Logo (Light)</span>
              <div class="preview-wrapper">
                <div id="discourse-logo" class="banner light" style="padding: 8px 16px 8px 8px;">
                  <img src="../suews-logo.svg" alt="SUEWS" style="width: 56px; height: 56px;">
                  <span class="text" style="font-size: 42px;">SUEWS</span>
                </div>
              </div>
            </div>
            <div class="preview-item">
              <span class="preview-item-label">Logo Dark</span>
              <div class="preview-wrapper">
                <div id="discourse-logo-dark" class="banner dark" style="padding: 8px 16px 8px 8px;">
                  <img src="../suews-logo.svg" alt="SUEWS" style="width: 56px; height: 56px;">
                  <span class="text" style="font-size: 42px;">SUEWS</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="preview-card">
          <div class="preview-label">Square Icons</div>
          <div class="stacked-preview-grid">
            <div class="stacked-item">
              <span class="preview-item-label">Logo Small (120px)</span>
              <div class="preview-wrapper" style="padding: 8px;">
                <div id="discourse-logo-small" style="width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; background: #f8fafc;">
                  <img src="../suews-logo.svg" style="width: 84px; height: 84px;" alt="SUEWS">
                </div>
              </div>
            </div>
            <div class="stacked-item">
              <span class="preview-item-label">Logo Small Dark</span>
              <div class="preview-wrapper" style="padding: 8px;">
                <div id="discourse-logo-small-dark" style="width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; background: #1a1d2e;">
                  <img src="../suews-logo.svg" style="width: 84px; height: 84px;" alt="SUEWS">
                </div>
              </div>
            </div>
            <div class="stacked-item">
              <span class="preview-item-label">Large Icon (512px scaled)</span>
              <div class="preview-wrapper" style="padding: 8px;">
                <div id="discourse-large-icon-preview" style="width: 120px; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f8fafc;">
                  <img src="../suews-logo.svg" style="width: 90px; height: 90px;" alt="SUEWS">
                  <span style="font-family: 'Inter', sans-serif; font-weight: 600; font-size: 17px; color: #1a1d2e; letter-spacing: -0.02em; margin-top: -10px;">SUEWS</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="preview-card">
          <div class="preview-label">Special Sizes</div>
          <div class="stacked-preview-grid">
            <div class="stacked-item">
              <span class="preview-item-label">Favicon (32px)</span>
              <div class="preview-wrapper" style="padding: 16px;">
                <div id="discourse-favicon" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: #f8fafc;">
                  <img src="../suews-logo.svg" style="width: 28px; height: 28px;" alt="SUEWS">
                </div>
              </div>
            </div>
            <div class="stacked-item">
              <span class="preview-item-label">Apple Touch (180px)</span>
              <div class="preview-wrapper" style="padding: 8px;">
                <div id="discourse-apple-touch" style="width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; background: #f8fafc; border-radius: 36px;">
                  <img src="../suews-logo.svg" style="width: 126px; height: 126px;" alt="SUEWS">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="preview-card">
          <div class="preview-label">Asset Specifications</div>
          <div class="info-panel">
            <div class="info-section">
              <div class="info-title">Export Summary</div>
              <div class="info-row"><span>Total Assets</span><span class="info-value">11 files</span></div>
              <div class="info-row"><span>Banners</span><span class="info-value">4 files (light, dark, mobile, digest)</span></div>
              <div class="info-row"><span>Square Icons</span><span class="info-value">5 files (small, small-dark, large, manifest, opengraph)</span></div>
              <div class="info-row"><span>Special</span><span class="info-value">2 files (favicon, apple-touch)</span></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <script>
    // ============ UTILITIES ============
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type + ' show';
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');

      document.getElementById('sidebar-banner').style.display = tab === 'banner' ? 'block' : 'none';
      document.getElementById('sidebar-stacked').style.display = tab === 'stacked' ? 'block' : 'none';
      document.getElementById('sidebar-discourse').style.display = tab === 'discourse' ? 'block' : 'none';
      document.getElementById('preview-banner').style.display = tab === 'banner' ? 'flex' : 'none';
      document.getElementById('preview-stacked').style.display = tab === 'stacked' ? 'flex' : 'none';
      document.getElementById('preview-discourse').style.display = tab === 'discourse' ? 'flex' : 'none';
    }

    // ============ BANNER CONTROLS ============
    const bannerControls = {
      logoSize: { range: 'logoSize', num: 'logoSizeNum', display: 'logoSize-display', unit: 'px', default: 56 },
      textSize: { range: 'textSize', num: 'textSizeNum', display: 'textSize-display', unit: 'px', default: 42 },
      gap: { range: 'gap', num: 'gapNum', display: 'gap-display', unit: 'px', default: 0 },
      paddingLeft: { range: 'paddingLeft', num: 'paddingLeftNum', display: 'paddingLeft-display', unit: 'px', default: 0 },
      paddingRight: { range: 'paddingRight', num: 'paddingRightNum', display: 'paddingRight-display', unit: 'px', default: 8 },
      paddingY: { range: 'paddingY', num: 'paddingYNum', display: 'paddingY-display', unit: 'px', default: 4 }
    };

    const banners = [document.getElementById('banner-light'), document.getElementById('banner-dark')];
    const logos = [document.getElementById('logo-light'), document.getElementById('logo-dark')];
    const texts = [document.getElementById('text-light'), document.getElementById('text-dark')];

    function getBannerValue(name) {
      return parseFloat(document.getElementById(bannerControls[name].range).value);
    }

    function setBannerValue(name, value) {
      const ctrl = bannerControls[name];
      document.getElementById(ctrl.range).value = value;
      document.getElementById(ctrl.num).value = value;
      document.getElementById(ctrl.display).textContent = value + ctrl.unit;
    }

    function updateBannerPreview() {
      const logoSize = getBannerValue('logoSize');
      const textSize = getBannerValue('textSize');
      const gap = getBannerValue('gap');
      const paddingLeft = getBannerValue('paddingLeft');
      const paddingRight = getBannerValue('paddingRight');
      const paddingY = getBannerValue('paddingY');

      banners.forEach(banner => {
        banner.style.gap = gap + 'px';
        banner.style.padding = `${paddingY}px ${paddingRight}px ${paddingY}px ${paddingLeft}px`;
      });

      logos.forEach(logo => {
        logo.style.width = logoSize + 'px';
        logo.style.height = logoSize + 'px';
      });

      texts.forEach(text => {
        text.style.fontSize = textSize + 'px';
      });

      // Update display values
      Object.keys(bannerControls).forEach(name => {
        const ctrl = bannerControls[name];
        document.getElementById(ctrl.display).textContent = getBannerValue(name) + ctrl.unit;
      });

      updateBannerInfo();
    }

    async function updateBannerInfo() {
      await document.fonts.ready;

      const banner = banners[0];
      const logo = logos[0];
      const text = texts[0];

      const bannerRect = banner.getBoundingClientRect();
      const logoRect = logo.getBoundingClientRect();
      const textRect = text.getBoundingClientRect();

      const svgInternalLeft = (290 / 2048) * logoRect.width;
      const svgInternalRight = (289.5 / 2048) * logoRect.width;
      const visualLeft = getBannerValue('paddingLeft') + svgInternalLeft;
      const visualRight = getBannerValue('paddingRight');
      const symmetryDiff = Math.abs(visualLeft - visualRight);

      const infoHTML = `
<div class="info-section">
  <div class="info-title">Output Dimensions</div>
  <div class="info-row"><span>Banner</span><span class="info-value">${bannerRect.width.toFixed(0)} x ${bannerRect.height.toFixed(0)} px</span></div>
  <div class="info-row"><span>Logo</span><span class="info-value">${logoRect.width.toFixed(0)} x ${logoRect.height.toFixed(0)} px</span></div>
  <div class="info-row"><span>Text</span><span class="info-value">${textRect.width.toFixed(0)} x ${textRect.height.toFixed(0)} px</span></div>
</div>
<div class="info-section">
  <div class="info-title">Visual Margins</div>
  <div class="info-row"><span>SVG Whitespace</span><span class="info-value">${svgInternalLeft.toFixed(1)}px (14.2%)</span></div>
  <div class="info-row"><span>Visual Left</span><span class="info-value">${visualLeft.toFixed(1)}px</span></div>
  <div class="info-row"><span>Visual Right</span><span class="info-value">${visualRight.toFixed(1)}px</span></div>
  <div class="info-row"><span>Symmetry</span><span class="${symmetryDiff < 2 ? 'info-good' : symmetryDiff < 5 ? 'info-warn' : 'info-bad'}">${symmetryDiff.toFixed(1)}px diff</span></div>
</div>
<div class="info-section">
  <div class="info-title">Design Ratios</div>
  <div class="info-row"><span>Text/Logo Height</span><span class="info-value">${(textRect.height / logoRect.height * 100).toFixed(0)}%</span></div>
  <div class="info-row"><span>Text/Logo Width</span><span class="info-value">${(textRect.width / logoRect.width * 100).toFixed(0)}%</span></div>
</div>`;

      document.getElementById('info-banner').innerHTML = infoHTML;
    }

    function applyBannerPreset(preset) {
      const presets = {
        discourse: { logoSize: 56, textSize: 42, gap: 0, paddingLeft: 0, paddingRight: 8, paddingY: 4 },
        github: { logoSize: 48, textSize: 36, gap: 4, paddingLeft: 4, paddingRight: 4, paddingY: 4 },
        compact: { logoSize: 40, textSize: 30, gap: 2, paddingLeft: 2, paddingRight: 4, paddingY: 2 }
      };

      const p = presets[preset];
      Object.keys(p).forEach(name => setBannerValue(name, p[name]));
      updateBannerPreview();
      showToast(`Applied ${preset} preset`);
    }

    function resetBanner() {
      Object.keys(bannerControls).forEach(name => {
        setBannerValue(name, bannerControls[name].default);
      });
      updateBannerPreview();
      showToast('Reset to defaults');
    }

    function copyBannerCSS() {
      const css = `.banner {
  display: inline-flex;
  align-items: center;
  gap: ${getBannerValue('gap')}px;
  padding: ${getBannerValue('paddingY')}px ${getBannerValue('paddingRight')}px ${getBannerValue('paddingY')}px ${getBannerValue('paddingLeft')}px;
}
.banner img { width: ${getBannerValue('logoSize')}px; height: ${getBannerValue('logoSize')}px; }
.banner .text { font-weight: 600; font-size: ${getBannerValue('textSize')}px; letter-spacing: -0.02em; }`;

      navigator.clipboard.writeText(css);
      showToast('CSS copied to clipboard');
    }

    // Banner event listeners
    Object.keys(bannerControls).forEach(name => {
      const ctrl = bannerControls[name];
      const range = document.getElementById(ctrl.range);
      const num = document.getElementById(ctrl.num);

      range.addEventListener('input', () => { num.value = range.value; updateBannerPreview(); });
      num.addEventListener('input', () => { range.value = num.value; updateBannerPreview(); });
    });

    // ============ STACKED ICON CONTROLS ============
    const stackedControls = {
      iconSize: { range: 'iconSize', num: 'iconSizeNum', display: 'iconSize-display', unit: 'px', default: 512 },
      stackFillPercent: { range: 'stackFillPercent', num: 'stackFillPercentNum', display: 'stackFillPercent-display', unit: '%', default: 100 },
      stackLogoPercent: { range: 'stackLogoPercent', num: 'stackLogoPercentNum', display: 'stackLogoPercent-display', unit: '%', default: 75 },
      stackTextSize: { range: 'stackTextSize', num: 'stackTextSizeNum', display: 'stackTextSize-display', unit: 'px', default: 72 },
      stackTextOffset: { range: 'stackTextOffset', num: 'stackTextOffsetNum', display: 'stackTextOffset-display', unit: 'px', default: -50 }
    };

    const stackedIcon = document.getElementById('stacked-icon');
    const stackedLogo = document.getElementById('stacked-logo');
    const stackedText = document.getElementById('stacked-text');
    const stackedIconSmall = document.getElementById('stacked-icon-small');
    const stackedLogoSmall = document.getElementById('stacked-logo-small');
    const stackedTextSmall = document.getElementById('stacked-text-small');

    function getStackedValue(name) {
      return parseFloat(document.getElementById(stackedControls[name].range).value);
    }

    function setStackedValue(name, value) {
      const ctrl = stackedControls[name];
      document.getElementById(ctrl.range).value = value;
      document.getElementById(ctrl.num).value = value;
      document.getElementById(ctrl.display).textContent = value + ctrl.unit;
    }

    async function updateStackedPreview() {
      const iconSize = getStackedValue('iconSize');
      const fillPercent = getStackedValue('stackFillPercent');
      const logoPercent = getStackedValue('stackLogoPercent');
      const textSize = getStackedValue('stackTextSize');
      const textOffset = getStackedValue('stackTextOffset');
      const logoSize = iconSize * logoPercent / 100;

      // SVG internal whitespace ratios
      const svgTopRatio = 240 / 2048;    // ~11.7%

      // Step 1: Set basic dimensions without padding first
      stackedIcon.style.width = iconSize + 'px';
      stackedIcon.style.height = iconSize + 'px';
      stackedIcon.style.paddingTop = '0px';
      stackedIcon.style.paddingBottom = '0px';
      stackedIcon.style.boxSizing = 'border-box';
      stackedLogo.style.width = logoSize + 'px';
      stackedLogo.style.height = logoSize + 'px';
      stackedText.style.fontSize = textSize + 'px';
      stackedText.style.marginTop = textOffset + 'px';

      // Wait for render
      await document.fonts.ready;
      await new Promise(r => requestAnimationFrame(r));

      // Step 2: Measure actual rendered dimensions
      const textRect = stackedText.getBoundingClientRect();
      const actualTextHeight = textRect.height;

      // Total content bounding box height (logo + text with offset)
      const contentHeight = logoSize + actualTextHeight + textOffset;

      // Step 3: Calculate perfect padding for true visual symmetry
      // Visual content height = logo visual + text
      // Logo visual top margin = logo * svgTopRatio
      // For perfect symmetry:
      // paddingTop + logo * svgTopRatio = paddingBottom
      // paddingTop + paddingBottom = iconSize - contentHeight
      // Solving: paddingBottom = (iconSize - contentHeight + logo * svgTopRatio) / 2
      //          paddingTop = paddingBottom - logo * svgTopRatio

      const svgTopOffset = logoSize * svgTopRatio;
      const totalPadding = iconSize - contentHeight;

      // Full symmetry padding values (baseline at 100%)
      const fullPaddingBottom = (totalPadding + svgTopOffset) / 2;
      const fullPaddingTop = (totalPadding - svgTopOffset) / 2;

      // Apply fill percentage - scales padding while maintaining symmetry ratio
      // Fill 100% = use full calculated padding (baseline, multiplier = 1.0)
      // Fill 130% = reduce padding by ~23% (content fills more, multiplier = 0.77)
      // Fill 80% = increase padding by 25% (content fills less, multiplier = 1.25)
      const paddingMultiplier = Math.max(0, 100 / fillPercent);
      const paddingTop = fullPaddingTop * paddingMultiplier;
      const paddingBottom = fullPaddingBottom * paddingMultiplier;

      // Step 4: Apply calculated padding
      stackedIcon.style.paddingTop = Math.max(0, paddingTop) + 'px';
      stackedIcon.style.paddingBottom = Math.max(0, paddingBottom) + 'px';

      // Small preview (scaled)
      const scale = 120 / iconSize;
      stackedIconSmall.style.width = '120px';
      stackedIconSmall.style.height = '120px';
      stackedIconSmall.style.paddingTop = Math.max(0, paddingTop * scale) + 'px';
      stackedIconSmall.style.paddingBottom = Math.max(0, paddingBottom * scale) + 'px';
      stackedIconSmall.style.boxSizing = 'border-box';
      stackedLogoSmall.style.width = (logoSize * scale) + 'px';
      stackedLogoSmall.style.height = (logoSize * scale) + 'px';
      stackedTextSmall.style.fontSize = (textSize * scale) + 'px';
      stackedTextSmall.style.marginTop = (textOffset * scale) + 'px';

      // Update displays
      Object.keys(stackedControls).forEach(name => {
        const ctrl = stackedControls[name];
        document.getElementById(ctrl.display).textContent = getStackedValue(name) + ctrl.unit;
      });

      document.getElementById('stacked-size-label').textContent = `${iconSize} x ${iconSize}`;

      // Wait for padding to apply, then measure final symmetry
      await new Promise(r => requestAnimationFrame(r));
      updateStackedInfo(iconSize, logoSize, textSize, textOffset, Math.max(0, paddingTop), Math.max(0, paddingBottom));
    }

    async function updateStackedInfo(iconSize, logoSize, textSize, textOffset, paddingTop, paddingBottom) {
      await document.fonts.ready;

      const iconRect = stackedIcon.getBoundingClientRect();
      const logoRect = stackedLogo.getBoundingClientRect();
      const textRect = stackedText.getBoundingClientRect();

      const svgInternalLeft = (290 / 2048) * logoSize;
      const svgInternalTop = (240 / 2048) * logoSize;
      const svgInternalBottom = (296 / 2048) * logoSize;

      const logoLeftInIcon = logoRect.left - iconRect.left;
      const logoTopInIcon = logoRect.top - iconRect.top;
      const textBottomMargin = iconRect.bottom - textRect.bottom;

      const visualLogoLeft = logoLeftInIcon + svgInternalLeft;
      const visualLogoRight = iconRect.right - logoRect.right + svgInternalLeft;
      const visualTop = logoTopInIcon + svgInternalTop;
      const visualBottom = textBottomMargin;

      const hDiff = Math.abs(visualLogoLeft - visualLogoRight);
      const vDiff = Math.abs(visualTop - visualBottom);

      // Update quick stats
      document.getElementById('h-diff').textContent = hDiff.toFixed(1);
      document.getElementById('v-diff').textContent = vDiff.toFixed(1);

      const statusEl = document.getElementById('symmetry-status');
      if (hDiff < 2 && vDiff < 5) {
        statusEl.className = 'status-badge status-good';
        statusEl.textContent = 'True Symmetry';
      } else if (hDiff < 5 && vDiff < 15) {
        statusEl.className = 'status-badge status-good';
        statusEl.textContent = 'Well Balanced';
      } else if (hDiff < 10 && vDiff < 30) {
        statusEl.className = 'status-badge status-warn';
        statusEl.textContent = 'Acceptable';
      } else {
        statusEl.className = 'status-badge status-bad';
        statusEl.textContent = 'Needs Adjustment';
      }

      const infoHTML = `
<div class="info-section">
  <div class="info-title">Visual Margins</div>
  <div class="info-row"><span>Left</span><span class="info-value">${visualLogoLeft.toFixed(1)}px</span></div>
  <div class="info-row"><span>Right</span><span class="info-value">${visualLogoRight.toFixed(1)}px</span></div>
  <div class="info-row"><span>Top</span><span class="info-value">${visualTop.toFixed(1)}px</span></div>
  <div class="info-row"><span>Bottom</span><span class="info-value">${visualBottom.toFixed(1)}px</span></div>
</div>
<div class="info-section">
  <div class="info-title">Symmetry Analysis</div>
  <div class="info-row"><span>Horizontal Diff</span><span class="${hDiff < 2 ? 'info-good' : 'info-warn'}">${hDiff.toFixed(1)}px</span></div>
  <div class="info-row"><span>Vertical Diff</span><span class="${vDiff < 5 ? 'info-good' : vDiff < 15 ? 'info-warn' : 'info-bad'}">${vDiff.toFixed(1)}px</span></div>
</div>
<div class="info-section">
  <div class="info-title">Computed Padding (asymmetric for symmetry)</div>
  <div class="info-row"><span>Padding Top</span><span class="info-value">${paddingTop.toFixed(1)}px</span></div>
  <div class="info-row"><span>Padding Bottom</span><span class="info-value">${paddingBottom.toFixed(1)}px</span></div>
  <div class="info-row"><span>Correction</span><span class="info-value">${(paddingBottom - paddingTop).toFixed(1)}px</span></div>
  <div class="info-row"><span>Fill Scale</span><span class="info-value">${getStackedValue('stackFillPercent')}% (${(100 / getStackedValue('stackFillPercent') * 100).toFixed(0)}% of baseline)</span></div>
</div>`;

      document.getElementById('info-stacked').innerHTML = infoHTML;
    }

    function suggestStackedOptimal() {
      const iconSize = getStackedValue('iconSize');
      const svgBottomRatio = 296 / 2048;

      const logoPercent = 75;
      const logoSize = iconSize * logoPercent / 100;
      const textSize = Math.round(iconSize * 0.14);
      const textOffset = Math.round(-logoSize * svgBottomRatio * 0.9);

      setStackedValue('stackFillPercent', 100);
      setStackedValue('stackLogoPercent', logoPercent);
      setStackedValue('stackTextSize', textSize);
      setStackedValue('stackTextOffset', textOffset);
      updateStackedPreview();
      showToast('Applied optimal values');
    }

    function applyStackedPreset(size) {
      setStackedValue('iconSize', parseInt(size));
      suggestStackedOptimal();
    }

    function resetStacked() {
      setStackedValue('iconSize', 512);
      setStackedValue('stackFillPercent', 100);
      setStackedValue('stackLogoPercent', 75);
      setStackedValue('stackTextSize', 72);
      setStackedValue('stackTextOffset', -50);
      updateStackedPreview();
      showToast('Reset to defaults');
    }

    function copyStackedCSS() {
      const iconSize = getStackedValue('iconSize');
      const logoPercent = getStackedValue('stackLogoPercent');
      const textSize = getStackedValue('stackTextSize');
      const textOffset = getStackedValue('stackTextOffset');
      const logoSize = iconSize * logoPercent / 100;

      const css = `.stacked-icon {
  width: ${iconSize}px;
  height: ${iconSize}px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: #f8fafc;
}
.stacked-icon img { width: ${logoSize.toFixed(0)}px; height: ${logoSize.toFixed(0)}px; }
.stacked-icon .text {
  font-family: 'Inter', sans-serif;
  font-weight: 600;
  font-size: ${textSize}px;
  margin-top: ${textOffset}px;
  letter-spacing: -0.02em;
}`;

      navigator.clipboard.writeText(css);
      showToast('CSS copied to clipboard');
    }

    // Stacked event listeners
    Object.keys(stackedControls).forEach(name => {
      const ctrl = stackedControls[name];
      const range = document.getElementById(ctrl.range);
      const num = document.getElementById(ctrl.num);

      range.addEventListener('input', () => { num.value = range.value; updateStackedPreview(); });
      num.addEventListener('input', () => { range.value = num.value; updateStackedPreview(); });
    });

    // ============ EXPORT ALL ============
    function exportAll() {
      const allCSS = `/* SUEWS Brand Assets - Generated ${new Date().toISOString().split('T')[0]} */

/* Banner */
.banner {
  display: inline-flex;
  align-items: center;
  gap: ${getBannerValue('gap')}px;
  padding: ${getBannerValue('paddingY')}px ${getBannerValue('paddingRight')}px ${getBannerValue('paddingY')}px ${getBannerValue('paddingLeft')}px;
}
.banner img { width: ${getBannerValue('logoSize')}px; height: ${getBannerValue('logoSize')}px; }
.banner .text { font-weight: 600; font-size: ${getBannerValue('textSize')}px; letter-spacing: -0.02em; }
.banner.light { background: #f8fafc; }
.banner.light .text { color: #1a1d2e; }
.banner.dark { background: #1a1d2e; }
.banner.dark .text { color: #ffffff; }

/* Stacked Icon */
.stacked-icon {
  width: ${getStackedValue('iconSize')}px;
  height: ${getStackedValue('iconSize')}px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: #f8fafc;
}
.stacked-icon img { width: ${(getStackedValue('iconSize') * getStackedValue('stackLogoPercent') / 100).toFixed(0)}px; height: ${(getStackedValue('iconSize') * getStackedValue('stackLogoPercent') / 100).toFixed(0)}px; }
.stacked-icon .text {
  font-family: 'Inter', sans-serif;
  font-weight: 600;
  font-size: ${getStackedValue('stackTextSize')}px;
  margin-top: ${getStackedValue('stackTextOffset')}px;
  letter-spacing: -0.02em;
}`;

      navigator.clipboard.writeText(allCSS);
      showToast('All CSS exported to clipboard');
    }

    // ============ EXPORT FUNCTIONS ============
    async function exportBannerPNG(theme) {
      await document.fonts.ready;

      const exportElement = async (el, filename) => {
        try {
          const dataUrl = await domtoimage.toPng(el, { quality: 1 });
          const link = document.createElement('a');
          link.download = filename;
          link.href = dataUrl;
          link.click();
        } catch (err) {
          console.error('Export failed:', err);
          showToast('Export failed - check console');
        }
      };

      if (theme === 'light' || theme === 'both') {
        await exportElement(document.getElementById('banner-light'), 'suews-banner-light.png');
      }
      if (theme === 'dark' || theme === 'both') {
        await new Promise(r => setTimeout(r, 200));
        await exportElement(document.getElementById('banner-dark'), 'suews-banner-dark.png');
      }

      showToast(theme === 'both' ? 'Exported both banners' : `Exported ${theme} banner`);
    }

    async function exportStackedPNG(scale = 1) {
      await document.fonts.ready;

      const el = document.getElementById('stacked-icon');
      const size = getStackedValue('iconSize');

      try {
        const dataUrl = await domtoimage.toPng(el, { quality: 1 });
        const link = document.createElement('a');
        const suffix = scale > 1 ? `@${scale}x` : '';
        link.download = `suews-icon-${size}${suffix}.png`;
        link.href = dataUrl;
        link.click();
        showToast(`Exported ${size}px icon`);
      } catch (err) {
        console.error('Export failed:', err);
        showToast('Export failed - check console');
      }
    }

    // ============ DISCOURSE EXPORT FUNCTIONS ============
    async function createDiscourseElement(type) {
      // Create off-screen elements with exact Discourse specifications
      const container = document.createElement('div');
      container.style.position = 'absolute';
      container.style.left = '-9999px';
      document.body.appendChild(container);

      let element;

      switch(type) {
        case 'logo':
        case 'mobile-logo':
        case 'digest-logo':
          // Wide banner, height 120px (Discourse spec: aspect ratio >3:1)
          element = document.createElement('div');
          element.style.cssText = 'display: inline-flex; align-items: center; padding: 8px 16px 8px 8px; background: #f8fafc;';
          element.innerHTML = `
            <img src="../suews-logo.svg" style="width: 104px; height: 104px;">
            <span style="font-family: 'Inter', sans-serif; font-weight: 600; font-size: 78px; color: #1a1d2e; letter-spacing: -0.02em;">SUEWS</span>
          `;
          break;

        case 'logo-dark':
          element = document.createElement('div');
          element.style.cssText = 'display: inline-flex; align-items: center; padding: 8px 16px 8px 8px; background: #1a1d2e;';
          element.innerHTML = `
            <img src="../suews-logo.svg" style="width: 104px; height: 104px;">
            <span style="font-family: 'Inter', sans-serif; font-weight: 600; font-size: 78px; color: #ffffff; letter-spacing: -0.02em;">SUEWS</span>
          `;
          break;

        case 'logo-small':
          // 120x120 square icon
          element = document.createElement('div');
          element.style.cssText = 'width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; background: #f8fafc;';
          element.innerHTML = `<img src="../suews-logo.svg" style="width: 100px; height: 100px;">`;
          break;

        case 'logo-small-dark':
          element = document.createElement('div');
          element.style.cssText = 'width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; background: #1a1d2e;';
          element.innerHTML = `<img src="../suews-logo.svg" style="width: 100px; height: 100px;">`;
          break;

        case 'large-icon':
        case 'manifest-icon':
        case 'opengraph':
          // 512x512 square with logo + text stacked
          element = document.createElement('div');
          element.style.cssText = 'width: 512px; height: 512px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f8fafc;';
          element.innerHTML = `
            <img src="../suews-logo.svg" style="width: 384px; height: 384px;">
            <span style="font-family: 'Inter', sans-serif; font-weight: 600; font-size: 72px; color: #1a1d2e; letter-spacing: -0.02em; margin-top: -55px;">SUEWS</span>
          `;
          break;

        case 'favicon':
          // 32x32 PNG
          element = document.createElement('div');
          element.style.cssText = 'width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: #f8fafc;';
          element.innerHTML = `<img src="../suews-logo.svg" style="width: 28px; height: 28px;">`;
          break;

        case 'apple-touch':
          // 180x180 with rounded corners appearance
          element = document.createElement('div');
          element.style.cssText = 'width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; background: #f8fafc;';
          element.innerHTML = `<img src="../suews-logo.svg" style="width: 150px; height: 150px;">`;
          break;

        case 'twitter-card':
          // Min 280x150, we'll do 560x300 for retina
          element = document.createElement('div');
          element.style.cssText = 'width: 560px; height: 300px; display: flex; align-items: center; justify-content: center; gap: 0; background: #f8fafc;';
          element.innerHTML = `
            <img src="../suews-logo.svg" style="width: 200px; height: 200px;">
            <span style="font-family: 'Inter', sans-serif; font-weight: 600; font-size: 100px; color: #1a1d2e; letter-spacing: -0.02em;">SUEWS</span>
          `;
          break;
      }

      container.appendChild(element);
      return { element, container };
    }

    async function exportSingleDiscourse(type) {
      await document.fonts.ready;

      const { element, container } = await createDiscourseElement(type);

      // Wait for images to load
      await new Promise(r => setTimeout(r, 100));
      await new Promise(r => requestAnimationFrame(r));

      try {
        const dataUrl = await domtoimage.toPng(element, { quality: 1 });
        const link = document.createElement('a');
        link.download = `suews-${type}.png`;
        link.href = dataUrl;
        link.click();
        showToast(`Exported ${type}`);
      } catch (err) {
        console.error('Export failed:', err);
        showToast('Export failed - check console');
      } finally {
        document.body.removeChild(container);
      }
    }

    async function exportDiscourseBanners() {
      showToast('Exporting banners...');
      await exportSingleDiscourse('logo');
      await new Promise(r => setTimeout(r, 300));
      await exportSingleDiscourse('logo-dark');
      await new Promise(r => setTimeout(r, 300));
      showToast('Banners exported');
    }

    async function exportDiscourseIcons() {
      showToast('Exporting icons...');
      await exportSingleDiscourse('logo-small');
      await new Promise(r => setTimeout(r, 300));
      await exportSingleDiscourse('logo-small-dark');
      await new Promise(r => setTimeout(r, 300));
      await exportSingleDiscourse('large-icon');
      await new Promise(r => setTimeout(r, 300));
      await exportSingleDiscourse('favicon');
      await new Promise(r => setTimeout(r, 300));
      await exportSingleDiscourse('apple-touch');
      showToast('Icons exported');
    }

    async function exportDiscourseAll() {
      showToast('Exporting all assets...');
      const assets = [
        'logo', 'logo-dark', 'logo-small', 'logo-small-dark',
        'large-icon', 'manifest-icon', 'favicon', 'apple-touch', 'twitter-card'
      ];

      for (const asset of assets) {
        await exportSingleDiscourse(asset);
        await new Promise(r => setTimeout(r, 300));
      }

      showToast('All 9 assets exported!');
    }

    // ============ INIT ============
    updateBannerPreview();
    updateStackedPreview();
  </script>
</body>
</html>
