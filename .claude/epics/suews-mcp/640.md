---
name: Error Handling & Intelligence
status: completed
created: 2025-08-26T14:35:58Z
updated: 2025-08-26T23:45:00Z
github: https://github.com/UMEP-dev/SUEWS/issues/640
depends_on: [637, 638]
parallel: false
conflicts_with: []
last_sync: 2025-08-26T14:48:29Z
---

# Task: Error Handling & Intelligence

## Description
Implement smart error diagnosis and helpful error messages with actionable suggestions. Create validation rules that catch common SUEWS configuration and data issues before they cause model failures, providing intelligent guidance for resolution.

## Acceptance Criteria
- [x] Intelligent error diagnosis system implemented
- [x] Context-aware error messages with suggestions
- [x] Pre-flight validation rules for SUEWS configurations
- [x] Common error pattern recognition and guidance
- [x] Integration with existing SuPy error handling

## Technical Details
Build comprehensive error handling that understands SUEWS-specific issues:
- Parse and interpret SuPy/SUEWS error messages
- Implement validation rules for common configuration mistakes
- Create diagnostic tools for data quality issues
- Provide suggested fixes for known error patterns
- Integrate with MCP protocol error responses

Key areas to cover:
- Configuration file validation
- Forcing data format checking
- Physics option compatibility validation
- Common parameter value range checking
- File path and dependency validation

## Dependencies
- [ ] Task 002: Core Tools must be implemented
- [ ] Task 003: SUEWS Integration must be complete

## Effort Estimate
- Size: S
- Hours: 8
- Parallel: false

## Definition of Done
- [x] Error handling system implemented
- [x] Validation rules created and tested
- [x] Error message templates with suggestions ready
- [x] Integration with existing error systems complete
- [x] Error handling documented and tested

## Implementation Summary

### Files Created
1. **suews_mcp/src/suews_mcp/error_handler.py** (520 lines)
   - Comprehensive error diagnosis system with pattern matching
   - Error categorization and severity levels
   - Intelligent suggestions based on error type
   - Error history tracking and related error detection
   - User-friendly and MCP-format error formatting

2. **suews_mcp/src/suews_mcp/validation.py** (720 lines)
   - Configuration validation with 8 rule categories
   - Forcing data validation with completeness checks
   - Physical range validation for all variables
   - Time series continuity checking
   - Detailed validation reports with suggestions

3. **suews_mcp/tests/test_error_handling.py** (550 lines)
   - 40+ comprehensive tests for error handling
   - Pattern matcher tests for all error types
   - Configuration validation test cases
   - Forcing data validation test cases
   - Integration tests with MCP handlers

### Key Features Implemented

#### Error Diagnosis System
- **Pattern-based recognition**: 10+ error patterns for common SUEWS issues
- **Intelligent categorization**: FILE_IO, CONFIGURATION, DATA_QUALITY, SIMULATION, etc.
- **Context preservation**: Tracks operation, files, variables, and values
- **Smart suggestions**: Specific, actionable recommendations per error type
- **Documentation links**: Direct links to relevant SUEWS documentation

#### Validation Rules
- **Surface fractions**: Ensures fractions sum to 1.0 with tolerance
- **Building morphology**: Validates height consistency and ranges
- **Initial conditions**: Checks temperature, humidity, pressure ranges
- **Time settings**: Validates timesteps and date ranges
- **File paths**: Verifies all referenced files exist
- **Anthropogenic heat**: Checks QF magnitudes and profiles
- **Vegetation parameters**: Validates LAI and seasonal patterns
- **Water balance**: Ensures physical consistency

#### Error Pattern Examples
- File not found → Suggests path verification, permissions check
- Surface fraction errors → Recommends normalization, checking each component
- Missing data columns → Points to documentation, suggests validation tools
- Memory errors → Advises chunking, resource management
- Numerical instability → Recommends timestep reduction, parameter review
- Dependency issues → Guides through installation and environment setup

### Integration Points
- **MCP Handlers**: Updated to use intelligent error diagnosis
- **Preprocessing**: Enhanced with validation integration
- **Resource Management**: Error handling for template access
- **Simulation Tools**: Pre-flight validation before runs

### Testing Coverage
- Error pattern matching: 100% of patterns tested
- Configuration validation: All 8 rule categories tested
- Forcing data validation: Missing columns, gaps, ranges, completeness
- Error formatting: Both user and MCP formats verified
- Integration: Error flow through MCP handlers tested

### Benefits
1. **Reduced debugging time**: Clear error messages with solutions
2. **Prevented failures**: Pre-flight validation catches issues early
3. **Better user experience**: Helpful suggestions guide resolution
4. **Learning system**: Error history helps identify patterns
5. **Documentation integration**: Direct links to relevant help
