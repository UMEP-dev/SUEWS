{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SUEWS Validation Report Schema",
  "description": "Schema for SUEWS YAML validation pipeline JSON reports",
  "version": "1.0.0",
  "type": "object",
  "required": ["schema_version", "timestamp", "summary", "phases"],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Version of this JSON schema",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp when report was generated",
      "format": "date-time"
    },
    "validation_id": {
      "type": "string",
      "description": "Optional unique identifier for this validation run"
    },
    "source_file": {
      "type": "string",
      "description": "Path to the source YAML file being validated"
    },
    "phases_completed": {
      "type": "array",
      "description": "List of phases that have been completed",
      "items": {
        "type": "string",
        "enum": ["A", "B", "C"]
      }
    },
    "summary": {
      "type": "object",
      "description": "Summary statistics of validation results",
      "required": ["total_errors", "total_warnings", "total_info", "validation_passed"],
      "properties": {
        "total_errors": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of errors across all phases"
        },
        "total_warnings": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of warnings across all phases"
        },
        "total_info": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of informational items across all phases"
        },
        "validation_passed": {
          "type": "boolean",
          "description": "Whether validation passed (no critical errors)"
        },
        "duration_ms": {
          "type": "number",
          "description": "Total validation duration in milliseconds"
        }
      }
    },
    "phases": {
      "type": "object",
      "description": "Results from each validation phase",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "completed": {
            "type": "boolean",
            "description": "Whether this phase completed successfully"
          },
          "timestamp": {
            "type": ["string", "null"],
            "description": "When this phase completed",
            "format": "date-time"
          },
          "duration_ms": {
            "type": "number",
            "description": "Phase execution duration in milliseconds"
          },
          "errors": {
            "type": "array",
            "description": "Errors found in this phase",
            "items": {"$ref": "#/definitions/validationItem"}
          },
          "warnings": {
            "type": "array",
            "description": "Warnings found in this phase",
            "items": {"$ref": "#/definitions/validationItem"}
          },
          "info": {
            "type": "array",
            "description": "Informational items from this phase",
            "items": {"$ref": "#/definitions/validationItem"}
          },
          "results": {
            "type": "object",
            "description": "Phase-specific results and data",
            "additionalProperties": true
          }
        }
      }
    },
    "errors": {
      "type": "array",
      "description": "All validation errors",
      "items": {"$ref": "#/definitions/validationItem"}
    },
    "warnings": {
      "type": "array",
      "description": "All validation warnings",
      "items": {"$ref": "#/definitions/validationItem"}
    },
    "info": {
      "type": "array",
      "description": "All informational items",
      "items": {"$ref": "#/definitions/validationItem"}
    },
    "suggestions": {
      "type": "array",
      "description": "Suggested fixes and improvements",
      "items": {
        "type": "object",
        "properties": {
          "field_path": {
            "type": "string",
            "description": "YAML path to the field"
          },
          "action": {
            "type": "string",
            "description": "Suggested action to take",
            "enum": ["add", "update", "remove", "replace", "validate"]
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of the suggestion"
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Confidence score for this suggestion"
          },
          "example": {
            "type": ["object", "string", "number", "boolean", "null"],
            "description": "Example value or structure"
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata about the validation",
      "additionalProperties": true
    }
  },
  "definitions": {
    "validationItem": {
      "type": "object",
      "required": ["phase", "type", "field_path", "message", "severity"],
      "properties": {
        "phase": {
          "type": "string",
          "description": "Which phase generated this item"
        },
        "type": {
          "type": "string",
          "description": "Type of validation item",
          "examples": [
            "missing_required_parameter",
            "parameter_renamed",
            "science_validation_error",
            "pydantic_validation_error",
            "value_out_of_range",
            "incompatible_options",
            "auto_correction",
            "default_applied"
          ]
        },
        "field_path": {
          "type": "string",
          "description": "YAML path to the field (e.g., 'model.physics.stebbsmethod')"
        },
        "message": {
          "type": "string",
          "description": "Human-readable message describing the issue"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "warning", "info"],
          "description": "Severity level of the item"
        },
        "details": {
          "type": "object",
          "description": "Additional context and details",
          "additionalProperties": true,
          "properties": {
            "current_value": {
              "description": "Current value in the YAML"
            },
            "expected_value": {
              "description": "Expected or valid value"
            },
            "valid_range": {
              "type": "object",
              "properties": {
                "min": {"type": "number"},
                "max": {"type": "number"}
              }
            },
            "requires_action": {
              "type": "boolean",
              "description": "Whether user action is required"
            },
            "yaml_location": {
              "type": "object",
              "properties": {
                "line": {"type": "integer"},
                "column": {"type": "integer"},
                "line_content": {"type": "string"}
              }
            },
            "documentation_url": {
              "type": "string",
              "format": "uri"
            }
          }
        },
        "suggestions": {
          "type": "array",
          "description": "Suggested fixes for this issue",
          "items": {
            "type": "string"
          }
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When this item was generated"
        }
      }
    }
  }
}